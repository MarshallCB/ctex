!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).ctex={})}(this,(function(t){"use strict";function e(t,i=(()=>{}),s="/",n="",r={}){var o,l=n?n+s:n;if(t&&t._isCtex)for(o of(i(n,t),t))e(t[o],i,s,l+o,r);else if(Array.isArray(t))for(o=0;o<t.length;o++)e(t[o],i,s,l+o,r);else if(t&&"object"==typeof t)for(o in t)e(t[o],i,s,l+o,r);else!function(t,e,i){e=e.split("/");for(var s,n=0,r=e.length,o=t;n<r;++n)s=o[e[n]],o=o[e[n]]=n===r-1?i:null!=s?s:!~e[n+1].indexOf(".")&&+e[n+1]>-1?[]:{}}(r,n,t);return r}function i(t,e,i,s){e=e.split("/");let n=t;for(i=0;i<e.length;i++)n=n?n[e[i]]:s;return n}class s{constructor(t,e,i){let n=function(t,e,i=!1){Object.defineProperty(this,t,i?e:{value:e})}.bind(this);n("init",t[0].bind(this)),n("r",Symbol()),n("_isCtex",!0),n("s",{}),n(Symbol.iterator,{*a(){yield*t[2],yield*t[3]}}.a);let r=this.values.bind(this);t[1].forEach(t=>{n(t,{set(i){Promise.resolve(e[t](i))},get:()=>e[t],enumerable:!0},!0)}),t[2].forEach(t=>{let{get:s,set:o}=Object.getOwnPropertyDescriptor(e,t);n("_$"+t,{writable:!0},!0),n(t,s?{get:s}:{set(e){this["_$"+t]=o?o(e):e,this.s[t]&&this.s[t].forEach(t=>Promise.resolve(t(e))),this.s[this.r]&&this.s[this.r].forEach(t=>Promise.resolve(t(r())))},get(){return this["_$"+t]},enumerable:!0},!0),s||(this[t]=i[t]||e[t])}),t[3].forEach(t=>{this[t]=e[t],this[t]instanceof s?this[t].set(i[t]||{}):this[t]=this[t](i[t]||{})}),Object.seal(this),this.init()}subscribe(t,e){let i=Symbol();return"function"==typeof t&&(e=t,t=this.r),this.s[t]||(this.s[t]=new Map),this.s[t].set(i,e),()=>this.s[t].delete(i)}set(t={},s=!0){for(let[e,i]of Object.entries(t))void 0===this[e]||null!=this[e]&&this[e]._isCtex||(this[e]=i);s&&e(this,(e,s)=>{s.set(i(t,e),!1)})}values(){return e(this)}}function n(t){let{init:e,...i}=t,n=function(t){let e=[[],[],[]];return Object.getOwnPropertyNames(t).forEach(i=>{"init"!==i&&e["function"==typeof t[i]?0:t[i]&&t[i]._isCtex?2:1].push(i)}),e}(i),r=(i={})=>new s([e||(()=>{}),...n],t,i);return r._isCtex=!0,r}t.Context=n,t.Network=function(t){let s=n(t)();function r(t){return i(s,t)}return r.get=function(t){let e=i(s,t);return e&&e._isCtex?e.values():e},r.post=function(t,e){return i(s,t)(e)},r.save=function(t){let i=(e,i)=>i.subscribe(i=>t(e,i));return i("index",s),e(s,i),r},r.load=function(t){let i=(e,i)=>{Promise.resolve(t(e)).then(t=>s.set(t)).catch(t=>console.log(t))};return i("index"),e(s,i),r},r},Object.defineProperty(t,"__esModule",{value:!0})}));
