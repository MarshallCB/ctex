!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).ctex={})}(this,(function(t){"use strict";function e(t,i=(()=>{}),s="/",n="",r={}){var o,u=n?n+s:n;if(Array.isArray(t))for(o=0;o<t.length;o++)e(t[o],i,s,u+o,r);else if(t&&"object"==typeof t)for(o in t._isCtex&&i(n,t),t)e(t[o],i,s,u+o,r);else!function(t,e,i){e=e.split("/");for(var s,n=0,r=e.length,o=t;n<r;++n)s=o[e[n]],o=o[e[n]]=n===r-1?i:null!=s?s:!~e[n+1].indexOf(".")&&+e[n+1]>-1?[]:{}}(r,n,t);return r}function i(t,e,i,s){e=e.split("/");let n=t;for(i=0;i<e.length;i++)n=n?n[e[i]]:s;return n}class s{constructor(t,i,n={}){let r=function(t,e,i){Object.defineProperty(this,t,i?e:{value:e})}.bind(this);r("_isCtex",!0),r("s",{}),t[1].map(t=>{r(t,{set(e){i[t](e)},get:()=>i[t]},!0)}),t[2].map(t=>{let{get:s,set:o}=Object.getOwnPropertyDescriptor(i,t);r("_$"+t,{writable:!0},!0),r(t,s?{get:s}:{set(i){if(i=o?o.bind(this)(i):i,this["_$"+t]!==i){this["_$"+t]=i;let s=this.s;if(s[t])for(let e of s[t])e(i,this);if(s[""]){e(this);for(let t of s[""])t(this)}}},get(){return this["_$"+t]},enumerable:!0},!0),s||(this[t]=n[t]||i[t])}),t[3].map(t=>{r(t,{set(e={}){this[t]instanceof s?this[t].set(e):this[t]=i[t](e)},enumerable:!0},!0),this[t]=n[t]}),Object.seal(this),t[0].call(this)}subscribe(t,e){if(void 0!==this[t])return e||(e=t,t=""),this[t]&&this[t]._isCtex?this[t].subscribe(e):(this.s[t]=this.s[t]||new Set,this.s[t].add(e),()=>this.s[t].delete(e))}set(t={}){Object.assign(this,t)}values(){return e(this)}}function n(t){let e=function(t,e){let i=[()=>{},[],[],[]];return Object.getOwnPropertyNames(t).map(s=>{e=t[s],"init"!==s?i["function"==typeof e?1:e&&e._isCtex?3:2].push(s):i[0]=e}),i}(t),i=i=>new s(e,t,i);return i._isCtex=!0,i}t.Context=t=>n(t)(),t.Model=n,t.Network=function(t){let s=n(t)();function r(t){return i(s,t)}return r.get=function(t){let e=i(s,t);return e&&e._isCtex?e.values():e},r.post=function(t,e){return i(s,t)(e)},r.save=function(t){let i=(e,i)=>i.subscribe(i=>t(e,i));return i("index",s),e(s,i),r},r.load=function(t){let i=(e,i)=>{Promise.resolve(t(e)).then(t=>s.set(t)).catch(t=>console.log(t))};return i("index"),e(s,i),r},r},Object.defineProperty(t,"__esModule",{value:!0})}));
