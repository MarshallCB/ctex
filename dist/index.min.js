!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).ctex={})}(this,(function(t){"use strict";class e{constructor(t,s,i){let r=function(t,e,s=!1){Object.defineProperty(this,t,s?e:{value:e})}.bind(this);r("init",t[0].bind(this)),r("r",Symbol()),r("_isCtex",!0),r("s",{}),r(Symbol.iterator,{*a(){yield*t[2],yield*t[3]}}.a);let o=this.values.bind(this);t[1].forEach(t=>{r(t,{set(e){Promise.resolve(s[t](e))},get:()=>s[t],enumerable:!0},!0)}),t[2].forEach(t=>{let{get:e,set:n}=Object.getOwnPropertyDescriptor(s,t);r("_$"+t,{writable:!0},!0),r(t,e?{get:e}:{set(e){this["_$"+t]=n?n(e):e,this.s[t]&&this.s[t].forEach(t=>Promise.resolve(t(e))),this.s[this.r]&&this.s[this.r].forEach(t=>Promise.resolve(t(o())))},get(){return this["_$"+t]},enumerable:!0},!0),e||(this[t]=i[t]||s[t])}),t[3].forEach(t=>{this[t]=s[t],this[t]instanceof e?this[t].set(i[t]||{}):this[t]=this[t](i[t]||{})}),Object.seal(this),this.init()}subscribe(t,e){let s=Symbol();return"function"==typeof t&&(e=t,t=this.r),this.s[t]||(this.s[t]=new Map),this.s[t].set(s,e),()=>this.s[t].delete(s)}set(t){for(let[e,s]of Object.entries(t))void 0!==this[e]&&(this[e]&&this[e]._isCtex?this[e].set(s):this[e]=s)}values(){let t={};for(var e of this)t[e]=this[e]&&this[e]._isCtex?this[e].values():this[e];return t}}t.Context=function(t){let{init:s,...i}=t,r=function(t){let e=[[],[],[]];return Object.getOwnPropertyNames(t).forEach(s=>{"init"!==s&&e["function"==typeof t[s]?0:t[s]&&t[s]._isCtex?2:1].push(s)}),e}(i),o=(i={})=>new e([s||(()=>{}),...r],t,i);return o._isCtex=!0,o},Object.defineProperty(t,"__esModule",{value:!0})}));
