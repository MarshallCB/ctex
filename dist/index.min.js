!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).ctex={})}(this,(function(e){"use strict";function t(e,i=(()=>{}),s="/",r="",n={}){var o,f=r?r+s:r;if(e&&e._isCtex)for(o of(i(r,e),e))t(e[o],i,s,f+o,n);else if(Array.isArray(e))for(o=0;o<e.length;o++)t(e[o],i,s,f+o,n);else if(e&&"object"==typeof e)for(o in e)t(e[o],i,s,f+o,n);else!function(e,t,i){t=t.split("/");for(var s,r=0,n=t.length,o=e;r<n;++r)s=o[t[r]],o=o[t[r]]=r===n-1?i:null!=s?s:!~t[r+1].indexOf(".")&&+t[r+1]>-1?[]:{}}(n,r,e);return n}function i(e,t,i,s){t=t.split("/");let r=e;for(i=0;i<t.length;i++)r=r?r[t[i]]:s;return r}class s{constructor(e,t,i){let r=function(e,t,i=!1){Object.defineProperty(this,e,i?t:{value:t})}.bind(this);r("init",e[0].bind(this)),r("r",Symbol()),r("_isCtex",!0),r("s",{}),r(Symbol.iterator,{*a(){yield*e[2],yield*e[3]}}.a),r("_methods",e[1]),r("_properties",e[2]),r("_nodes",e[3]);let n=this.values.bind(this);e[1].forEach(e=>{r(e,{set(i){Promise.resolve(t[e](i))},get:()=>t[e],enumerable:!0},!0)}),e[2].forEach(e=>{let{get:s,set:o}=Object.getOwnPropertyDescriptor(t,e);r("_$"+e,{writable:!0},!0),r(e,s?{get:s}:{set(t){this["_$"+e]=o?o(t):t,this.s[e]&&this.s[e].forEach(e=>Promise.resolve(e(t))),this.s[this.r]&&this.s[this.r].forEach(e=>Promise.resolve(e(n())))},get(){return this["_$"+e]},enumerable:!0},!0),s||(this[e]=i[e]||t[e])}),e[3].forEach(e=>{this[e]=t[e],this[e]instanceof s?this[e].set(i[e]):this[e]=this[e](i[e])}),Object.seal(this),this.init()}subscribe(e,t,i=Symbol()){return"function"==typeof e&&(t=e,e=this.r),this.s[e]||(this.s[e]=new Map),this.s[e].set(i,t),()=>this.s[e].delete(i)}set(e={},s=!0){this._properties.forEach(t=>{void 0!==e[t]&&(this[t]=e[t])}),s&&t(this,(t,s)=>{s.set(i(e,t),!1)})}values(){return t(this)}}function r(e){let{init:t,...i}=e,r=function(e){let t=[[],[],[]];return Object.getOwnPropertyNames(e).forEach(i=>{"init"!==i&&t["function"==typeof e[i]?0:e[i]&&e[i]._isCtex?2:1].push(i)}),t}(i),n=(i={})=>new s([t||(()=>{}),...r],e,i);return n._isCtex=!0,n}e.Context=r,e.Network=function(e){let s=r(e)();function n(e){return i(s,e)}return n.get=function(e){let t=i(s,e);return t&&t._isCtex?t.values():t},n.post=function(e,t){return i(s,e)(t)},n.save=function(e){let i=(t,i)=>i.subscribe(i=>e(t,i));return i("index",s),t(s,i),n},n.load=function(e){let i=(t,i)=>{Promise.resolve(e(t)).then(e=>s.set(e)).catch(e=>console.log(e))};return i("index"),t(s,i),n},n},Object.defineProperty(e,"__esModule",{value:!0})}));
