!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).ctex={})}(this,(function(t){"use strict";var e=Object.prototype.hasOwnProperty;function s(t,r){var i,o;if(t===r)return!0;if(t&&r&&(i=t.constructor)===r.constructor){if(i===Date)return t.getTime()===r.getTime();if(i===RegExp)return t.toString()===r.toString();if(i===Array){if((o=t.length)===r.length)for(;o--&&s(t[o],r[o]););return-1===o}if(!i||"object"==typeof t){for(i in o=0,t){if(e.call(t,i)&&++o&&!e.call(r,i))return!1;if(!(i in r)||!s(t[i],r[i]))return!1}return Object.keys(r).length===o}}return t!=t&&r!=r}const r={CONTEXT:Symbol("ctex-context"),MODEL:Symbol("ctex-model")};class i{constructor(t){this.values={},this.subs={};const e=new Proxy({},{get:(t,e)=>this.values[e],set:(t,e,s)=>this.setter(e,s)});Object.keys(t).forEach(s=>{let i=t[s];i&&(i[r.MODEL]&&(i=i({})),i[r.CONTEXT]&&i.$$(()=>this.trigger())),this.values[s]="function"==typeof i?i.bind(e):i});const s=(t,e)=>(this.subs[t]=this.subs[t]||new Set,this.subs[t].add(e),()=>this.subs[t].delete(e));this.$=new Proxy(t=>s("$",t),{get:(t,e)=>t=>s(e,t)}),this.$$=t=>s("$$",t)}propogate(t,e){if(t){const s=this.subs[t];if(s)for(const t of s)t(...e)}}trigger(t,...e){this.propogate(t,e),this.propogate("$$",[this.all()]),this.triggered||(this.triggered=!0,setTimeout(()=>{this.propogate("$",[this.all()]),this.triggered=!1},0))}setter(t,e){const i=this.values[t];if(i&&i[r.CONTEXT]){if(i!==e&&e&&e[r.CONTEXT])this.values[t]=e,e.$$(()=>this.trigger()),this.trigger(t,e,i);else if(!s(i,e)){const s={...i};this.trigger(t,Object.assign(i,e),s)}}else s(i,e)||(this.values[t]=e,this.trigger(t,e,i));return!0}getter(t){const e=this.values[t];return e&&e[r.CONTEXT]?new Proxy({...e},{get:(t,s)=>e[s],set:(t,s,r)=>(e[s]=r,!0)}):e}all(){let t={};return Object.keys(this.values).forEach(e=>{"function"!=typeof this.values[e]&&(t[e]=this.getter(e))}),t}}function o(){const t=Object.assign({},...arguments);let e=(e={})=>{const s=new i(t);Object.keys(e).forEach(t=>{s.setter(t,e[t])});let o=s.all();return s.$$(t=>Object.assign(o,t)),new Proxy(o,{get:(t,e)=>e===r.CONTEXT||("$"===e?s.$:"$$"===e?s.$$:s.getter(e)),set:(t,e,r)=>s.setter(e,r)})};return e[r.MODEL]=!0,e}const n=()=>o(...arguments)();t.CTEX=r,t.Context=n,t.Model=o,Object.defineProperty(t,"__esModule",{value:!0})}));
