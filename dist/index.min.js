!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).ctex={})}(this,(function(e){"use strict";function t(e,i=(()=>{}),s="/",n="",r={}){var o,f=n?n+s:n;if(e&&e._isCtex)for(o of(i(n,e),e))t(e[o],i,s,f+o,r);else if(Array.isArray(e))for(o=0;o<e.length;o++)t(e[o],i,s,f+o,r);else if(e&&"object"==typeof e)for(o in e)t(e[o],i,s,f+o,r);else!function(e,t,i){t=t.split("/");for(var s,n=0,r=t.length,o=e;n<r;++n)s=o[t[n]],o=o[t[n]]=n===r-1?i:null!=s?s:!~t[n+1].indexOf(".")&&+t[n+1]>-1?[]:{}}(r,n,e);return r}function i(e,t,i,s){t=t.split("/");let n=e;for(i=0;i<t.length;i++)n=n?n[t[i]]:s;return n}class s{constructor(e,i,n){let r=function(e,t,i=!1){Object.defineProperty(this,e,i?t:{value:t})}.bind(this);r("_isCtex",!0),r("s",{}),r(Symbol.iterator,{*a(){yield*e[2],yield*e[3]}}.a),e[1].map(e=>{r(e,{set(t){Promise.resolve(i[e](t))},get:()=>i[e],enumerable:!0},!0)}),e[2].map(e=>{let{get:s,set:o}=Object.getOwnPropertyDescriptor(i,e);r("_$"+e,{writable:!0},!0),r(e,s?{get:s}:{set(i){if(i=o?o(i):i,this["_$"+e]!==i){this["_$"+e]=i;let s=this.s;if(s[e])for(let t of s[e])Promise.resolve(t(i));if(s[""]){let e=t(this);for(let t of s[""])Promise.resolve(t(e))}}},get(){return this["_$"+e]},enumerable:!0},!0),s||(this[e]=n[e]||i[e])}),e[3].map(e=>{r(e,{set(t={}){this[e]instanceof s?this[e].set(t):this[e]=i[e](t)},enumerable:!0},!0),this[e]=n[e]}),Object.seal(this),e[0].bind(this)()}subscribe(e,t,i=Symbol()){if(void 0!==this[e])return t||(t=e,e=""),t=t.bind(this),this[e]&&this[e]._isCtex?this[e].subscribe(t):(this.s[e]=this.s[e]||new Set,this.s[e].add(t),()=>this.s[e].delete(t))}set(e={}){Object.assign(this,e)}values(){return t(this)}}function n(e){let t=t=>function(e,t={}){return new s(function(e,t){let i=[()=>{},[],[],[]];return Object.getOwnPropertyNames(e).forEach(s=>{t=e[s],"init"!==s?i["function"==typeof t?1:t&&t._isCtex?3:2].push(s):i[0]=t}),i}(e),e,t)}(e,t);return t._isCtex=!0,t}e.Model=n,e.Network=function(e){let s=n(e)();function r(e){return i(s,e)}return r.get=function(e){let t=i(s,e);return t&&t._isCtex?t.values():t},r.post=function(e,t){return i(s,e)(t)},r.save=function(e){let i=(t,i)=>i.subscribe(i=>e(t,i));return i("index",s),t(s,i),r},r.load=function(e){let i=(t,i)=>{Promise.resolve(e(t)).then(e=>s.set(e)).catch(e=>console.log(e))};return i("index"),t(s,i),r},r},Object.defineProperty(e,"__esModule",{value:!0})}));
