function t(e,s=(()=>{}),i="/",n="",r={}){var o,u=n?n+i:n;if(Array.isArray(e))for(o=0;o<e.length;o++)t(e[o],s,i,u+o,r);else if(e&&"object"==typeof e)for(o in e._isCtex&&s(n,e),e)t(e[o],s,i,u+o,r);else!function(t,e,s){e=e.split("/");for(var i,n=0,r=e.length,o=t;n<r;++n)i=o[e[n]],o=o[e[n]]=n===r-1?s:null!=i?i:!~e[n+1].indexOf(".")&&+e[n+1]>-1?[]:{}}(r,n,e);return r}function e(t,e,s,i){e=e.split("/");let n=t;for(s=0;s<e.length;s++)n=n?n[e[s]]:i;return n}class s{constructor(e,i,n={}){let r=function(t,e,s){Object.defineProperty(this,t,s?e:{value:e})}.bind(this);r("_isCtex",!0),r("s",{}),e[1].map(t=>{r(t,{set(e){i[t](e)},get:()=>i[t]},!0)}),e[2].map(e=>{let{get:s,set:o}=Object.getOwnPropertyDescriptor(i,e);r("_$"+e,{writable:!0},!0),r(e,s?{get:s}:{set(s){if(s=o?o(s):s,this["_$"+e]!==s){this["_$"+e]=s;let i=this.s;if(i[e])for(let t of i[e])t(s,this);if(i[""]){t(this);for(let t of i[""])t(this)}}},get(){return this["_$"+e]},enumerable:!0},!0),s||(this[e]=n[e]||i[e])}),e[3].map(t=>{r(t,{set(e={}){this[t]instanceof s?this[t].set(e):this[t]=i[t](e)},enumerable:!0},!0),this[t]=n[t]}),Object.seal(this),e[0].call(this)}subscribe(t,e){if(void 0!==this[t])return e||(e=t,t=""),this[t]&&this[t]._isCtex?this[t].subscribe(e):(this.s[t]=this.s[t]||new Set,this.s[t].add(e),()=>this.s[t].delete(e))}set(t={}){Object.assign(this,t)}values(){return t(this)}}function i(t){let e=function(t,e){let s=[()=>{},[],[],[]];return Object.getOwnPropertyNames(t).map(i=>{e=t[i],"init"!==i?s["function"==typeof e?1:e&&e._isCtex?3:2].push(i):s[0]=e}),s}(t),i=i=>new s(e,t,i);return i._isCtex=!0,i}function n(s){let n=i(s)();function r(t){return e(n,t)}return r.get=function(t){let s=e(n,t);return s&&s._isCtex?s.values():s},r.post=function(t,s){return e(n,t)(s)},r.save=function(e){let s=(t,s)=>s.subscribe(s=>e(t,s));return s("index",n),t(n,s),r},r.load=function(e){let s=(t,s)=>{Promise.resolve(e(t)).then(t=>n.set(t)).catch(t=>console.log(t))};return s("index"),t(n,s),r},r}export{i as Model,n as Network};
